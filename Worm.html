<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Worm Simulation with Network Lines</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background:#0d1117; color:#e5e7eb; padding:20px; }
    h1 { color:#22c55e; text-align:center; }
    p { text-align:center; color:#cbd5e1; }

    .network-container { position:relative; width:100%; display:flex; justify-content:center; margin-top:25px; }
    .network { display:flex; flex-wrap:wrap; justify-content:center; gap:15px; position:relative; z-index:1; }

    .node {
      width:130px; height:100px; padding:12px; border-radius:12px;
      background:#161b22; border:2px solid #30363d;
      text-align:center; transition:0.3s, box-shadow 0.3s;
      position:relative;
    }
    .node.infected {
      border-color:#f97316;
      box-shadow:0 0 15px rgba(249,115,22,0.7);
      animation: pulse 1s infinite alternate;
    }
    @keyframes pulse {
      0% { box-shadow:0 0 10px rgba(249,115,22,0.5);}
      100% { box-shadow:0 0 25px rgba(249,115,22,0.9);}
    }
    .node strong { display:block; margin-bottom:5px; color:#c9d1d9; }
    .status { font-size:12px; color:#94a3b8; }

    canvas { position:absolute; top:0; left:0; pointer-events:none; z-index:0; }

    .controls { text-align:center; margin-top:15px; }
    button { 
      padding:10px 16px; border:none; border-radius:6px;
      background:#22c55e; color:#022c22; font-weight:bold; cursor:pointer;
      margin:0 5px; transition:0.2s;
    }
    button:hover { background:#16a34a; }
    button:disabled { background:#4ade80; cursor:not-allowed; }

    .log { 
      margin-top:20px; padding:15px; background:#161b22; border-radius:10px; 
      border:1px solid #30363d; height:200px; overflow-y:auto;
      font-size:13px;
    }
    .log hr { border-color:#30363d; margin:8px 0; }
  </style>
</head>
<body>
  <h1>Worm Simulation (Animated)</h1>
  <p>Watch the worm spread visually through the network!</p>

  <div class="controls">
    <button id="startBtn">Infect Node 1</button>
    <button id="resetBtn">Reset Network</button>
  </div>

  <div class="network-container">
    <canvas id="lineCanvas"></canvas>
    <div class="network" id="network"></div>
  </div>

  <div class="log" id="log"><strong>Worm Activity:</strong><br></div>

  <script>
    const networkDiv = document.getElementById("network");
    const canvas = document.getElementById("lineCanvas");
    const logDiv = document.getElementById("log");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");

    let ctx = canvas.getContext("2d");
    let nodes = [];
    const NODE_COUNT = 12;
    let wormInterval = null;

    function resizeCanvas() {
      canvas.width = networkDiv.offsetWidth;
      canvas.height = networkDiv.offsetHeight;
    }
    window.addEventListener('resize', resizeCanvas);

    function log(msg) {
      logDiv.innerHTML += msg + "<br>";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function createNetwork() {
      nodes = [];
      networkDiv.innerHTML = "";
      for (let i = 0; i < NODE_COUNT; i++) {
        const node = { id:i+1, infected:false, wormCopies:0, el:null };
        nodes.push(node);

        const el = document.createElement("div");
        el.className = "node";
        el.id = "node-" + node.id;
        el.innerHTML = `
          <strong>Node ${node.id}</strong>
          <div class="status">Status: Clean</div>
          <div class="status">Worm copies: 0</div>
        `;
        node.el = el;
        networkDiv.appendChild(el);
      }
      resizeCanvas();
    }

    function getNodeCenter(node) {
      const rect = node.el.getBoundingClientRect();
      const parentRect = networkDiv.getBoundingClientRect();
      return {
        x: rect.left + rect.width/2 - parentRect.left,
        y: rect.top + rect.height/2 - parentRect.top
      };
    }

    function drawLine(fromNode, toNode) {
      const from = getNodeCenter(fromNode);
      const to = getNodeCenter(toNode);
      ctx.strokeStyle = "rgba(249,115,22,0.7)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(from.x, from.y);
      ctx.lineTo(to.x, to.y);
      ctx.stroke();
    }

    function renderNetwork() {
      nodes.forEach(node => {
        const el = node.el;
        const statusEls = el.querySelectorAll(".status");
        if (node.infected) {
          el.classList.add("infected");
          statusEls[0].textContent = "Status: INFECTED";
        } else {
          el.classList.remove("infected");
          statusEls[0].textContent = "Status: Clean";
        }
        statusEls[1].textContent = "Worm copies: " + node.wormCopies;
      });
    }

    const worm = {
      spread() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const infectedNodes = nodes.filter(n => n.infected);
        if (!infectedNodes.length) return;

        infectedNodes.forEach(node => {
          node.wormCopies++;
          log(`Worm replicated on Node ${node.id} (copies: ${node.wormCopies}).`);

          for (let i = 0; i < 2; i++) {
            const targetIndex = Math.floor(Math.random() * nodes.length);
            const target = nodes[targetIndex];
            if (!target.infected) {
              target.infected = true;
              target.wormCopies = 1;
              drawLine(node, target); // Draw visual line
              log(`Worm spread from Node ${node.id} to Node ${target.id}.`);
            }
          }
        });

        renderNetwork();

        if (nodes.every(n => n.infected)) {
          log("<strong>All nodes infected. Worm spreading stopped.</strong>");
          clearInterval(wormInterval);
          wormInterval = null;
          startBtn.disabled = false;
        }
      }
    };

    startBtn.addEventListener("click", () => {
      log("<hr>User infected Node 1 manually. Worm spreading started.");
      const first = nodes[0];
      first.infected = true;
      first.wormCopies = 1;
      renderNetwork();

      if (!wormInterval) {
        wormInterval = setInterval(() => worm.spread(), 1000);
      }
      startBtn.disabled = true;
    });

    resetBtn.addEventListener("click", () => {
      if (wormInterval) { clearInterval(wormInterval); wormInterval=null; }
      ctx.clearRect(0,0,canvas.width,canvas.height);
      createNetwork();
      renderNetwork();
      log("<hr>Network reset to clean state.");
      startBtn.disabled = false;
    });

    createNetwork();
    renderNetwork();
  </script>
</body>
</html>